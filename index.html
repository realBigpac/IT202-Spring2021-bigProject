<!DOCTYPE html>
<html>
  <head>
    <title>Crypto Tracker</title>
    <link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet">
    <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script src="https://unpkg.com/dexie@latest/dist/dexie.js"></script>
    <style>
      .screen {
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="mdc-tab-bar" role="tablist" data-mdc-auto-init="MDCTabBar">
      <div class="mdc-tab-scroller">
        <div class="mdc-tab-scroller__scroll-area">
          <div class="mdc-tab-scroller__scroll-content nav">
            <button class="mdc-tab mdc-tab--active" role="tab" aria-selected="true" tabindex="0">
              <span class="mdc-tab__content">
                <span class="mdc-tab__text-label">Home</span>
              </span>
              <span class="mdc-tab-indicator mdc-tab-indicator--active">
                <span class="mdc-tab-indicator__content mdc-tab-indicator__content--underline"></span>
              </span>
              <span class="mdc-tab__ripple" data-screen="Home"></span>
            </button>
            <button class="mdc-tab" role="tab" aria-selected="true" tabindex="0">
              <span class="mdc-tab__content">
                <span class="mdc-tab__text-label">Form</span>
              </span>
              <span class="mdc-tab-indicator">
                <span class="mdc-tab-indicator__content mdc-tab-indicator__content--underline"></span>
              </span>
              <span class="mdc-tab__ripple" data-screen="Form"></span>
            </button>
            <button class="mdc-tab" role="tab" aria-selected="true" tabindex="0">
              <span class="mdc-tab__content">
                <span class="mdc-tab__text-label">Search</span>
              </span>
              <span class="mdc-tab-indicator">
                <span class="mdc-tab-indicator__content mdc-tab-indicator__content--underline"></span>
              </span>
              <span class="mdc-tab__ripple" data-screen="Data"></span>
            </button>
            <button class="mdc-tab" role="tab" aria-selected="true" tabindex="0">
              <span class="mdc-tab__content">
                <span class="mdc-tab__text-label">Stored Data</span>
              </span>
              <span class="mdc-tab-indicator">
                <span class="mdc-tab-indicator__content mdc-tab-indicator__content--underline"></span>
              </span>
              <span class="mdc-tab__ripple" data-screen="Stored_Data"></span>
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="Home screen">
      <div class="mdc-card mdc-card--outlined" data-mdc-auto-init="MDCRipple">
        <h>Welcome to Crypto Tracker!</h>
        <p>This app is used to track what tickers are popular and show the areas where each ticker is most searched for</p>
      </div>
    </div>
    <div class="Form screen">
      <div class="mdc-form-field" id="params" data-mdc-auto-init="MDCFormField">
        <label class="mdc-text-field mdc-text-field--filled" data-mdc-auto-init="MDCTextField">
          <span class="mdc-text-field__ripple"></span>
          <span class="mdc-floating-label" id="my-label-id">Enter a symbol</span>
          <input class="mdc-text-field__input sym" type="text" aria-labelledby="my-label-id">
          <span class="mdc-line-ripple"></span>
        </label>
        <label class="mdc-text-field mdc-text-field--filled" data-mdc-auto-init="MDCTextField">
          <span class="mdc-text-field__ripple"></span>
          <span class="mdc-floating-label" id="my-label-id">Enter a name</span>
          <input class="mdc-text-field__input name" type="text" aria-labelledby="my-label-id">
          <span class="mdc-line-ripple"></span>
        </label>
        <div class="mdc-switch" data-mdc-auto-init="MDCSwitch">
          <div class="mdc-switch__track"></div>
          <div class="mdc-switch__thumb-underlay">
            <div class="mdc-switch__thumb"></div>
            <input type="checkbox" id="basic-switch" class="mdc-switch__native-control coin-g" role="switch" aria-checked="false">
          </div>
        </div>
        <label for="basic-switch">coin gecko</label>
        <div class="mdc-switch" data-mdc-auto-init="MDCSwitch">
          <div class="mdc-switch__track"></div>
          <div class="mdc-switch__thumb-underlay">
            <div class="mdc-switch__thumb"></div>
            <input type="checkbox" id="basic-switch" class="mdc-switch__native-control coin-p" role="switch" aria-checked="false">
          </div>
        </div>
        <label for="basic-switch">coin paprika</label>
        <div class="mdc-switch" data-mdc-auto-init="MDCSwitch">
          <div class="mdc-switch__track"></div>
          <div class="mdc-switch__thumb-underlay">
            <div class="mdc-switch__thumb"></div>
            <input type="checkbox" id="basic-switch" class="mdc-switch__native-control mode" role="switch" aria-checked="false">
          </div>
        </div>
        <label for="basic-switch">online/offline</label>
      </div>
      <button class="mdc-button mdc-button--raised search" data-mdc-auto-init="MDCRipple">
        <span class="mdc-button__label">Search</span>
      </button>
    </div>
    <div class="Data screen">
      <div class="mdc-card mdc-card--outlined example" data-mdc-auto-init="MDCRipple">
        <p id="id">id</p>
        <p id="symbol">symbol</p>
        <p id="name">name</p>
      </div>
      <div class="mdc-card mdc-card--outlined cards" data-mdc-auto-init="MDCRipple">
      </div>
    </div>
    <div class="Stored_Data screen">
      <div class="mdc-card mdc-card--outlined" data-mdc-auto-init="MDCRipple">
        <p>Stored Data</p>
      </div>
    </div>
    <script>
      window.mdc.autoInit();

      let endpoint1 = "https://api.coingecko.com/api/v3/coins/list";
      let endpoint2 = "https://api.coinpaprika.com/v1/coins";
      
      var db = new Dexie("Crypto Info");
      db.version(1).stores({ 
        cryptos: 'name,symbol,id,database'
      });

      fetch (endpoint1)
        .then ( (response) => { return response.json() })
        .then ( (json) => {
          for (let item of json) {
            db.cryptos.add( {name: item.name, symbol: item.symbol, id: item.id, database: "coin_g"} )
          }
      });
      fetch (endpoint2)
        .then ( (response) => { return response.json() })
        .then ( (json) => {
          for (let item of json) {
            db.cryptos.add( {name: item.name, symbol: item.symbol, id: item.id, database: "coin_p"}  )
          }
      });
      document.querySelector(".Home").style.display = "block";
      let navAnchors = document.querySelectorAll("div.nav button")
      navAnchors.forEach( (anchor) => {
        anchor.addEventListener("click", (event) => {
          document.querySelectorAll(".screen").forEach( (screen) => {
            screen.style.display = "none";
          })
          let screen = event.target.getAttribute("data-screen");
          let targetScreen = document.querySelector("." + screen);
          targetScreen.style.display = "block";
        })
      })
      
      document.querySelector(".search").addEventListener("click", (e) => {
        document.querySelectorAll(".card").forEach ( (card) => { 
          card.remove()
        });
        document.querySelector(".Form").style.display = "none"
        document.querySelector(".Data").style.display = "block"
        
        if (document.querySelector(".coin-g").getAttribute("aria-checked") == "true") {
          if (document.querySelector(".name").value != "") {
            let name = document.querySelector(".name").value;
            if (name == item.name) {
              let clone = document.querySelector(".example").cloneNode(true);
              clone.querySelector("#id").innerText = item.id;
              clone.querySelector("#symbol").innerText = item.symbol;
              clone.querySelector("#name").innerText = item.name;
              clone.style.display = "block";
              clone.classList.add("card");
              clone.classList.remove("example");
              document.querySelector(".cards").appendChild(clone);
            }
          } else if (document.querySelector(".sym").value != "") {
            let sym = document.querySelector(".sym").value;
            if (sym == item.symbol) {
              let clone = document.querySelector(".example").cloneNode(true);
              clone.querySelector("#id").innerText = item.id;
              clone.querySelector("#symbol").innerText = item.symbol;
              clone.querySelector("#name").innerText = item.name;
              clone.style.display = "block";
              clone.classList.add("card");
              clone.classList.remove("example");
              document.querySelector(".cards").appendChild(clone);
            }
          } else {
            let clone = document.querySelector(".example").cloneNode(true);
            clone.querySelector("#id").innerText = item.id;
            clone.querySelector("#symbol").innerText = item.symbol;
            clone.querySelector("#name").innerText = item.name;
            clone.style.display = "block";
            clone.classList.add("card");
            clone.classList.remove("example");
            document.querySelector(".cards").appendChild(clone);
          }
        }
        if (document.querySelector(".coin-p").getAttribute("aria-checked") == "true") {
          if (document.querySelector(".name").value != "") {
            let name = document.querySelector(".name").value;
            if (name == item.name) {
              let clone = document.querySelector(".example").cloneNode(true);
              clone.querySelector("#id").innerText = item.id;
              clone.querySelector("#symbol").innerText = item.symbol;
              clone.querySelector("#name").innerText = item.name;
              clone.style.display = "block";
              clone.classList.add("card");
              clone.classList.remove("example");
              document.querySelector(".cards").appendChild(clone);
            }
          } else if (document.querySelector(".sym").value != "") {
            let sym = document.querySelector(".sym").value;
            if (sym == item.symbol) {
              let clone = document.querySelector(".example").cloneNode(true);
              clone.querySelector("#id").innerText = item.id;
              clone.querySelector("#symbol").innerText = item.symbol;
              clone.querySelector("#name").innerText = item.name;
              clone.style.display = "block";
              clone.classList.add("card");
              clone.classList.remove("example");
              document.querySelector(".cards").appendChild(clone);
            }
          } else {
            let clone = document.querySelector(".example").cloneNode(true);
            clone.querySelector("#id").innerText = item.id;
            clone.querySelector("#symbol").innerText = item.symbol;
            clone.querySelector("#name").innerText = item.name;
            clone.style.display = "block";
            clone.classList.add("card");
            clone.classList.remove("example");
            document.querySelector(".cards").appendChild(clone);
          }
        }
      });
      document.querySelector(".coin-g").getAttribute("aria-checked")
    </script>
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register('./sw.js').then(function(registration) {
            // Registration was successful
            console.log('ServiceWorker registration successful with scope: ', registration.scope);
          }, function(err) {
            // registration failed :(
            console.log('ServiceWorker registration failed: ', err);
          });
        });
      }
    </script>
  </body>
</html>